<script type="module">
import { auth, db } from "./firebase.js";
import { onAuthStateChanged } from 
"https://www.gstatic.com/firebasejs/10.12.1/firebase-auth.js";
import { collection, getDocs, deleteDoc, doc } from 
"https://www.gstatic.com/firebasejs/10.12.1/firebase-firestore.js";

onAuthStateChanged(auth, async (user) => {
  if (!user) {
    alert("Login required");
    location.href = "login.html";
    return;
  }

  const cartDiv = document.getElementById("cartItems");
  const snap = await getDocs(collection(db, "carts", user.uid, "items"));
  let total = 0;
  cartDiv.innerHTML = "";

  snap.forEach(d => {
    const item = d.data();
    total += item.price;
    cartDiv.innerHTML += `
      <div class="cart-item">
        <img src="${item.img}">
        <div>${item.name} - ₹${item.price}</div>
        <button onclick="remove('${d.id}')">Remove</button>
      </div>
    `;
  });

  document.getElementById("totalAmount").innerText = "Total: ₹" + total;
});

window.remove = async (id) => {
  const user = auth.currentUser;
  await deleteDoc(doc(db, "carts", user.uid, "items", id));
  location.reload();
};
</script>
