<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Boat Airdopes 131 - HomeKart</title>

<style>
/* ==== YOUR ORIGINAL DESIGN (UNCHANGED) ==== */
body { font-family: Arial, sans-serif; background:#f1f3f6; margin:0; }
.container { max-width:1200px; margin:20px auto; background:#fff; padding:20px; border-radius:5px; }
.top-bar { text-align:right; margin-bottom:15px; }
.top-bar a { background:#2874f0; color:#fff; padding:8px 14px; border-radius:4px; text-decoration:none; }
.product-main { display:flex; gap:30px; flex-wrap:wrap; }
.left { display:flex; gap:15px; flex:1; }
.thumbs { display:flex; flex-direction:column; gap:10px; }
.thumbs img { width:60px; height:60px; border:1px solid #ddd; border-radius:6px; cursor:pointer; }
.main-img { width:450px; height:450px; border-radius:6px; object-fit:cover; border:1px solid #ddd; }
.right { flex:1.2; }
.price { font-size:28px; color:green; margin:10px 0; }
.buttons { display:flex; gap:20px; margin:20px 0; flex-wrap:wrap; }
.btn { padding:12px 30px; font-size:16px; border:none; color:#fff; cursor:pointer; border-radius:4px; flex:1; }
.add-cart { background:#ff9f00; }
.buy-now { background:#fb641b; }
.go-cart { background:#2874f0; }

@media (max-width:768px){
.product-main{flex-direction:column; align-items:center;}
.left{flex-direction:column; align-items:center;}
.thumbs{flex-direction:row;}
.main-img{width:90%; height:auto;}
.buttons{flex-direction:column;}
}
</style>
</head>

<body>

<div class="container">
    <div class="top-bar">
        <a onclick="history.back()">Back</a>
    </div>

    <div class="product-main">
        <div class="left">
            <div class="thumbs">
                <img src="boatbud3" onclick="changeImage('boatbud3')">
                <img src="boatbud1" onclick="changeImage('boatbud1')">
                <img src="boatbud2" onclick="changeImage('boatbud2')">
            </div>
            <img id="mainImage" class="main-img" src="boatbud3">
        </div>

        <div class="right">
            <h1>boAt Airdopes 131 Bluetooth Earbuds</h1>
            <div class="price">â‚¹999</div>

            <div class="buttons">
                <button class="btn add-cart" id="addCartBtn">Add to Cart</button>
                <button class="btn buy-now">Buy Now</button>
                <button class="btn go-cart" id="goCartBtn">Go to Cart</button>
            </div>

            <p>Lightweight wireless earbuds with immersive sound.</p>
        </div>
    </div>
</div>

<!-- ================= FIREBASE LOGIC (FIXED) ================= -->
<script type="module">
import { auth, db } from "./firebase.js";
import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-auth.js";
import { collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-firestore.js";

let currentUser = null;

// ðŸ” Auth state listener (REAL FIX)
onAuthStateChanged(auth, (user) => {
    if (user) {
        currentUser = user;
    } else {
        currentUser = null;

        // Disable buttons when logged out
        document.getElementById("addCartBtn").onclick = () => {
            alert("Please login to add items to cart");
            window.location.href = "login.html";
        };

        document.getElementById("goCartBtn").onclick = () => {
            alert("Please login to view cart");
            window.location.href = "login.html";
        };
    }
});

// ðŸ›’ Add to cart (ONLY if logged in)
document.getElementById("addCartBtn").addEventListener("click", async () => {
    if (!currentUser) return;

    try {
        await addDoc(collection(db, "carts", currentUser.uid, "items"), {
            name: "boAt Airdopes 131",
            price: 999,
            img: "boatbud3",
            createdAt: serverTimestamp()
        });

        alert("Added to cart");
    } catch (e) {
        alert("Failed to add to cart");
        console.error(e);
    }
});

// âž¡ï¸ Go to cart
document.getElementById("goCartBtn").addEventListener("click", () => {
    if (!currentUser) return;
    window.location.href = "cart.html";
});

// Image switch
window.changeImage = (img) => {
    document.getElementById("mainImage").src = img;
};
</script>

</body>
</html>
